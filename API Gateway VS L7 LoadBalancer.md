[ID: 7]
[Tags: INFRA]
[Title: API Gateway VS L7 LoadBalancer]
[WriteTime: 2023/07/18]
[ImageNames: 1234bff5-a8b2-41b4-940c-687804a1934e.png]

## 개요

Istio를 공부하던 중, Istio가 API 게이트웨이 기능을 지원한다는 것을 알게되었다. API 게이트웨이가 뭔지 얕게 찾아보니, L7 로드밸런서와 유사한 역할을 맡는다는 것을 알았다. 그렇지만 L7 로드밸런서와 동일하지는 않은 것 같다.

차이점을 알아보고, API 게이트웨이에 대한 개념을 익혀야겠다.

---

## L7 로드밸런서

로드밸런서는 백엔드로 가는 네트워크 트래픽을 효과적으로 분산시켜주는 장치이다. 서버의 성능과 속도를 고려해서 가장 효율적으로 트래픽을 분산시킨다.

로드밸런서는 OSI L4, L7으로 나뉘는데, 그 중 L7 로드밸런서의 특징을 살펴보자.

L7 로드밸런서는 OSI 7계층에 속해있기 때문에, HTTP/HTTPS 요청을 처리한다. 

HTTP/HTTPS 요청을 처리하기 때문에, 요청본문, 헤더, 쿠키, 세션, 요청 URL 경로등을 통해 어디로 트래픽을 라우팅할 지 결정할 수 있다. L4가 IP주소와 Port로 라우팅을 하는 것보다 훨씬 더 정교한 방식이다.

트래픽을 라우팅할 수 있는 백엔드 서버가 여러 곳이라면, 라운드로빈 뿐만 아니라 다양한 로드밸런싱 알고리즘을 통해 트래픽을 전달할 수 있다.

또 보안을 위한 SSL/TLS 인증서 관리, SSL/TLS 종료 및 요청 유효성 검사를 통해서 외부에서 직접적으로 서버에 접근하려는 공격은 없는지 확인한다.

---

## API 게이트웨이

API 게이트웨이는 일반적인 어플리케이션보다는 마이크로서비스 아키텍처에서 많이 사용되는 용어이다.

L7 로드밸런서와 유사한 기능을 수행하지만, 추가적인 기능들을 가지고있다.

### Caching

API 게이트웨이는 캐싱 기능을 수행한다.

클라이언트가 요청하는 데이터를 가지고있다가 서버까지 요청을 보내지않고 API 게이트웨이 선에서 캐싱된 데이터를 응답할 수 있다.

### Rate Limiting

클라이언트가 보내는 요청에 속도제한을 걸 수 있다.

만약 클라이언트가 정해진 rate limit을 넘겨서 요청을 보낼 경우, API 게이트웨이는 queue에 요청을 담아두고 천천히 서버에 전달하거나, 아니면 클라이언트에게 오류를 응답해서 일정 시간동안 클라이언트가 재요청을 못하도록 막을 수도 있다.

### Request Validation

요청이 유효한 요청인지를 1차적으로 확인할 수 있다. 요청에 필요한 헤더가 있는지, 요청 본문 데이터의 형식이 정확한지 등을 판단하고 API 게이트웨이 선에서 에러를 리턴할 수 있다.

### Spiky Traffic Handling

단시간에 트래픽이 과하게 몰리는 경우, 이를 감지하고 오토스케일링 등의 스케일아웃을 실행시키거나 할 수 있다.

---

API 게이트웨이는 L7 로드밸런서와 다르게 이런 특징을 가지고있다. 

---

## 정리

L7 로드밸런서가 더 큰 범위이고, 해당 기능들을 수행할 수 있으며, 마이크로서비스 아키텍처에서 사용되는 L7 로드밸런서를 API 게이트웨이라고 부르는 것 같다.

근데 사실 L7 로드밸런서이면서 API 게이트웨이 역할을 수행하는 경우가 대부분인 것 같고, 이런 이유로 L7 로드밸런서와 API 게이트웨이는 많이 혼용되는 것 같다. 어느 곳에서는 L7 로드밸런서가 캐싱이 가능하다고 설명하는 사람도 있었다.

차이점을 알아보면서 API 게이트웨이의 기능들이 특별히 **\"백엔드 서버의 부담을 최소화\"** 시키는 것에 중점을 두고 있음을 알게되었다.

Caching, Rate limit, Request validation check, Spiky traffic handling 모두 서버까지 요청을 보내지 않고, API 게이트웨이 선에서 처리하거나, 서버에 부담이 될 일을 사전에 방지하는 역할을 한다.

**유사하지만 서버의 부담을 줄여주는 기능에 초점이 맞춰져있다면 API 게이트웨이, 외부와의 접속 및 보안 등 전체적인 부분에 좀 더 초점이 맞춰져있다면 L7 로드밸런서**

이게 내가 내린 결론이다.

---

## 참고

[What is Load Balancing? - Nginx](https://www.nginx.com/resources/glossary/load-balancing/)

[AWS Application Load Balancer vs API Gateway - medium](https://devopslearning.medium.com/aws-application-load-balancer-vs-api-gateway-c667238977c